start: pacman_goal
nodes:
  pacman_goal:
    question: >
      pacman is Arch Linux’s package manager.
      It installs, removes, updates, and inspects software.
      What are you trying to do right now?
    options:
      i: "Install software"
      r: "Remove software"
      s: "Search or inspect packages"
      u: "Update the system"
      c: "Clean up the system"
    next:
      i: install_flow
      r: remove_flow
      s: search_flow
      u: update_flow
      c: clean_flow
  install_flow:
    question: >
      Where is the package coming from?
      This determines which pacman command is appropriate.
    options:
      o: "Official Arch repositories"
      a: "Local file (already downloaded)"
    next:
      o: install_repo
      a: install_local
  install_repo:
    result:
      - description: >
          Installing from official repositories is the safest and most common method.
      - description: >
          Install a package:
        command: "sudo pacman -S package"
      - description: >
          Tips:
          - Use --needed to avoid reinstalling up-to-date packages
          - pacman resolves dependencies automatically
  install_local:
    question: >
      Do you already have a built package file
      (ending in .pkg.tar.zst)?
    options:
      y: "Yes"
      n: "No, I only have a PKGBUILD"
    next:
      y: install_built
      n: install_unbuilt
  install_built:
    result:
      - description: >
          Local built packages can be installed directly.
        command: "sudo pacman -U package.pkg.tar.zst"
      - description: >
          pacman will still resolve and install required dependencies.
  install_unbuilt:
    result:
      - description: >
          If you only have a PKGBUILD, the package must be built first.
      - description: >
          Use makepkg inside the PKGBUILD directory:
        command: "makepkg -si"
      - description: >
          This will:
          - Build the package
          - Install dependencies
          - Install the resulting package
  remove_flow:
    question: >
      How do you want to remove the package?
      Arch allows fine-grained control over dependencies.
    options:
      k: "Remove only the package"
      n: "Remove package and unused dependencies"
    next:
      k: remove_keep
      n: remove_deps
  remove_keep:
    result:
      - description: >
          This removes only the selected package.
        command: "sudo pacman -R package"
      - description: >
          Dependencies remain installed.
  remove_deps:
    question: >
      Do you also want to remove configuration files?
    options:
      y: "Yes (full cleanup)"
      n: "No (keep configs)"
    next:
      y: remove_deps_config
      n: remove_deps_keep
  remove_deps_keep:
    result:
      - description: >
          Removes the package and dependencies that are no longer required.
        command: "sudo pacman -Rs package"
      - description: >
          Configuration files are preserved.
  remove_deps_config:
    result:
      - description: >
          This is the most aggressive removal option.
      - description: >
          Removes:
          - Package
          - Unused dependencies
          - Configuration files
        command: "sudo pacman -Rns package"
      - description: >
          Use with caution — configs cannot be recovered easily.
  search_flow:
    question: >
      What kind of information are you looking for?
    options:
      n: "Search by name or description"
      f: "Find which package owns a file"
      i: "Inspect an installed package"
    next:
      n: search_name
      f: search_file
      i: inspect_pkg
  search_name:
    result:
      - description: >
          Search official repositories:
        command: "pacman -Ss keyword"
      - description: >
          Search installed packages only:
        command: "pacman -Qs keyword"
  search_file:
    question: >
      Do you know whether the file is already installed?
    options:
      y: "Yes"
      n: "Not sure / probably not"
    next:
      y: search_file_installed
      n: search_file_remote
  search_file_installed:
    result:
      - description: >
          Find which installed package owns a file:
        command: "pacman -Qo /path/to/file"
  search_file_remote:
    result:
      - description: >
          Search which package provides a file:
        command: "pacman -F filename"
      - description: >
          Requires the file database:
        command: "sudo pacman -Fy"
  inspect_pkg:
    result:
      - description: >
          View detailed information about an installed package:
        command: "pacman -Qi package"
      - description: >
          List files installed by a package:
        command: "pacman -Ql package"
  update_flow:
    question: >
      Are you performing a full system upgrade?
    options:
      y: "Yes"
      n: "No / only one package"
    next:
      y: full_upgrade
      n: partial_warn
  full_upgrade:
    result:
      - description: >
          Arch Linux requires full system upgrades.
        command: "sudo pacman -Syu"
      - description: >
          Best practices:
          - Read Arch news before upgrading
          - Resolve pacnew / pacsave files after upgrades
  partial_warn:
    result:
      - description: >
          ⚠️ WARNING: Partial upgrades are unsupported on Arch Linux.
      - description: >
          Installing or upgrading a single package without a full upgrade
          can break your system.
      - description: >
          Always use pacman -Syu.
  clean_flow:
    question: >
      What do you want to clean up?
    options:
      c: "Package cache"
      o: "Orphaned packages"
    next:
      c: clean_cache
      o: clean_orphans
  clean_cache:
    result:
      - description: >
          pacman keeps downloaded packages for rollback.
      - description: >
          Remove old cached packages:
        command: "sudo pacman -Sc"
      - description: >
          Remove all cached packages (not recommended often):
        command: "sudo pacman -Scc"
  clean_orphans:
    result:
      - description: >
          Orphaned packages are dependencies no longer required.
      - description: >
          List orphaned packages:
        command: "pacman -Qtd"
      - description: >
          Remove all orphans:
        command: "pacman -Qtdq | sudo pacman -Rns -"
