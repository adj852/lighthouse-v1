start: detect_partial
nodes:
  detect_partial:
    question: >
      Arch Linux does not support partial upgrades.
      A very common mistake is refreshing package databases
      without upgrading the full system.
      Did you run pacman with -Sy (or -Syy) without -u?
    options:
      y: "Yes"
      n: "No"
      u: "Not sure"
    next:
      y: explain_partial
      u: explain_partial
      n: other_issue
  explain_partial:
    question: >
      Partial upgrades break ABI and dependency consistency
      in a rolling-release distribution.
    options:
      c: "Continue"
    next:
      c: why_partial_breaks
  why_partial_breaks:
    question: >
      Why is this a problem on Arch Linux?
    options:
      r: "Rolling release model"
      a: "ABI / library version changes"
      p: "Package dependency chains"
    next:
      r: partial_effects
      a: partial_effects
      p: partial_effects
  partial_effects:
    result:
      - description: >
          Arch Linux is a rolling release distribution.
          Packages are built and tested together as a snapshot.
      - description: >
          Libraries frequently change ABI (soname bumps).
          Applications built against newer libraries
          may not run with older ones.
      - description: >
          Refreshing the package database without upgrading
          allows pacman to install new packages
          that depend on newer libraries not yet installed.
      - description: >
          This leads to:
          - Dependency resolution failures
          - Broken or crashing binaries
          - Subtle and hard-to-debug system instability
  other_issue:
    question: >
      Are you currently troubleshooting dependency errors,
      broken packages, or pacman refusing to proceed?
    options:
      y: "Yes"
      n: "No"
    next:
      y: recovery
      n: no_partial
  recovery:
    result:
      - description: >
          The correct recovery from a partial upgrade
          is almost always a full system upgrade.
      - description: >
          Ensure mirrors are synchronized before upgrading.
        command: "sudo pacman -Syy"
      - description: >
          Perform a full system upgrade.
        command: "sudo pacman -Syu"
      - description: >
          After upgrading:
          - Rebuild any AUR packages
          - Reboot if core libraries or the kernel were updated
  no_partial:
    result:
      - description: >
          If no partial upgrade occurred,
          dependency issues may be caused by:
          - Package transitions
          - AUR packages built against old libraries
          - Out-of-date mirrors
      - description: >
          Recommended actions:
          - Read Arch news
          - Fully upgrade the system
          - Rebuild affected AUR packages
