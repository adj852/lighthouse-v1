start: boot_goal

nodes:
  boot_goal:
    question: >
      Boot optimization means different things depending on
      where the delay happens.
      What is your main goal?
    options:
      s: "My system boots slowly"
      a: "I want to analyze boot time"
      o: "I want to optimize startup services"
    next:
      s: slow_boot
      a: analyze_intro
      o: optimize_intro

  slow_boot:
    question: >
      Where does the delay happen?
      This helps narrow things down quickly.
    options:
      y: "After the bootloader, before login"
      n: "Before Linux starts (firmware / bootloader)"
    next:
      y: userspace
      n: firmware

  firmware:
    result:
      - description: >
          Firmware (BIOS/UEFI) delays happen before Linux starts.
          Linux and systemd cannot control this stage.
      - description: >
          Common causes:
          - Long POST (hardware checks)
          - Network boot (PXE)
          - USB or optical drive probing
      - description: >
          What you can do:
          - Disable unused boot devices
          - Disable PXE / network boot
          - Enable fast boot if available
      - description: >
          If the delay happens before the bootloader menu appears,
          this is almost always firmware-related.

  userspace:
    question: >
      The delay happens after Linux starts.
      This usually means systemd services.
      Do you want to analyze userspace boot time?
    options:
      y: "Yes"
    next:
      y: analyze_intro

  analyze_intro:
    question: >
      systemd provides built-in tools to analyze boot performance.
      These tools are safe and read-only.
      Do you want to run them?
    options:
      y: "Yes"
    next:
      y: analyze

  analyze:
    result:
      - description: >
          Measure total boot time:
          firmware + bootloader + kernel + userspace.
      - command: "systemd-analyze"
      - description: >
          Focus on the userspace time.
          That is where optimization is usually possible.
    next:
      blame_hint

  blame_hint:
    question: >
      Want to see which services take the longest to start?
    options:
      y: "Yes"
      n: "No"
    next:
      y: blame
      n: critical_chain_intro

  blame:
    result:
      - description: >
          List services ordered by startup time:
      - command: "systemd-analyze blame"
      - description: >
          Important:
          - A slow service is not always a problem
          - Some services wait for hardware or network
          - Time does NOT equal importance

  critical_chain_intro:
    question: >
      Want to understand service dependencies?
      This shows what actually blocks the boot process.
    options:
      y: "Yes"
      n: "No"
    next:
      y: critical_chain
      n: optimize_intro

  critical_chain:
    result:
      - description: >
          Show the critical boot path:
      - command: "systemd-analyze critical-chain"
      - description: >
          This is often more useful than blame,
          because it shows what is actually delaying login.

  optimize_intro:
    question: >
      Optimization means disabling or adjusting services.
      This must be done carefully.
      Do you want to continue?
    options:
      y: "Yes"
      n: "No"
    next:
      y: optimize
      n: finish_safe

  optimize:
    result:
      - description: >
          Rules for safe optimization:
      - description: >
          ✔ Disable services you recognize and do not use
          ✔ Prefer disabling over masking
          ✔ Test changes one at a time
      - description: >
          ⚠ Do NOT disable:
          - systemd-logind
          - dbus
          - udev
          - graphical.target
          - multi-user.target
      - description: >
          To disable a service:
      - command: "sudo systemctl disable SERVICE"
      - description: >
          To stop it immediately (optional):
      - command: "sudo systemctl stop SERVICE"

  finish_safe:
    result:
      - description: >
          If you are unsure, do NOT disable services blindly.
          A slightly slower boot is better than a broken system.
      - description: >
          Arch Wiki recommendation:
          Understand what a service does before disabling it.
