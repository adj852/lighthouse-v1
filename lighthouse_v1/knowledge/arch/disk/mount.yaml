start: mount_goal

nodes:
  mount_goal:
    question: >
      Mounting defines how and when filesystems become accessible.
      What type of filesystem are you mounting?
    options:
      s: "System partitions (root, boot, home)"
      d: "Additional data disks"
      r: "Removable media (USB, external drives)"
      n: "Network filesystems"
      t: "Temporary / one-time mounts"
    next:
      s: system_mount
      d: data_mount
      r: removable_mount
      n: network_mount
      t: temp_mount

  # =================================================
  # SYSTEM PARTITIONS
  # =================================================

  system_mount:
    question: >
      Do you want this filesystem mounted automatically at boot?
    options:
      y: "Yes (recommended)"
      n: "No"
    next:
      y: fstab
      n: manual_mount

  fstab:
    question: >
      How should the device be referenced in /etc/fstab?
    options:
      u: "UUID (recommended)"
      l: "Filesystem LABEL"
      d: "Device path (/dev/sdX) â€” not recommended"
    next:
      u: fstab_uuid
      l: fstab_label
      d: fstab_device

  fstab_uuid:
    result:
      - description: >
          UUIDs uniquely identify filesystems.
      - description: >
          They remain stable across:
          - Reboots
          - Disk reordering
          - Hardware changes
      - description: >
          Recommended for all system-critical mounts.

  fstab_label:
    result:
      - description: >
          LABELs are human-readable names for filesystems.
      - description: >
          They are convenient but must be unique.
      - description: >
          Acceptable for non-critical mounts.

  fstab_device:
    result:
      - description: >
          Device paths like /dev/sda1 are unreliable.
      - description: >
          They may change depending on detection order.
      - description: >
          Can cause boot failure if misused.

  # =================================================
  # FSTAB SAFETY
  # =================================================

  fstab_safety:
    question: >
      Is this filesystem essential for boot?
    options:
      y: "Yes"
      n: "No"
    next:
      y: critical_mount
      n: optional_mount

  critical_mount:
    result:
      - description: >
          Critical filesystems must be mounted successfully.
      - description: >
          Incorrect fstab entries can prevent boot.
      - description: >
          Always test fstab with:
        command: "sudo mount -a"

  optional_mount:
    result:
      - description: >
          Optional disks should not block boot.
      - description: >
          Use the following options:
          - nofail
          - x-systemd.device-timeout=5s

  # =================================================
  # ADDITIONAL DATA DISKS
  # =================================================

  data_mount:
    question: >
      Should this disk mount automatically at boot?
    options:
      y: "Yes"
      n: "No, only when needed"
    next:
      y: automount
      n: manual_mount

  automount:
    result:
      - description: >
          systemd supports on-demand mounting.
      - description: >
          Filesystems mount when first accessed.
      - description: >
          Prevents boot delays if disk is slow or missing.
      - description: >
          Add to fstab options:
        command: "x-systemd.automount"

  manual_mount:
    result:
      - description: >
          Manual mounts do not require fstab entries.
      - description: >
          Use the mount command directly.
        command: "mount /dev/sdX /mnt"

  # =================================================
  # PERMISSIONS & OWNERSHIP
  # =================================================

  permissions:
    question: >
      Do users need write access?
    options:
      y: "Yes"
      n: "No"
    next:
      y: ownership
      n: permissions_note

  ownership:
    result:
      - description: >
          Linux filesystems use Unix permissions.
      - description: >
          Ownership is controlled by:
          - chown
          - chmod
      - description: >
          Some filesystems (vfat, ntfs) require mount options.

  permissions_note:
    result:
      - description: >
          System partitions should usually remain root-owned.
      - description: >
          This prevents accidental damage.

  # =================================================
  # REMOVABLE MEDIA
  # =================================================

  removable_mount:
    question: >
      How do you want removable media handled?
    options:
      a: "Automatically via desktop environment"
      m: "Manually via mount command"
    next:
      a: automount_desktop
      m: manual_mount

  automount_desktop:
    result:
      - description: >
          Most desktop environments auto-mount removable media.
      - description: >
          Managed by udisks and polkit.
      - description: >
          No fstab configuration required.

  # =================================================
  # NETWORK FILESYSTEMS
  # =================================================

  network_mount:
    question: >
      Which type of network filesystem?
    options:
      n: "NFS (Linux/Unix)"
      c: "CIFS / SMB (Windows shares)"
    next:
      n: nfs_mount
      c: cifs_mount

  nfs_mount:
    result:
      - description: >
          NFS is commonly used in Unix environments.
      - description: >
          Requires nfs-utils.
      - description: >
          Network mounts should always use:
          - nofail
          - x-systemd.automount

  cifs_mount:
    result:
      - description: >
          CIFS is used for Windows and NAS shares.
      - description: >
          Credentials should not be stored in plain fstab.
      - description: >
          Use a credentials file with restricted permissions.

  # =================================================
  # TEMPORARY MOUNTS
  # =================================================

  temp_mount:
    result:
      - description: >
          Temporary mounts are for one-time use.
      - description: >
          No fstab entry is needed.
      - description: >
          Always unmount after use.
        command: "umount /mnt"

  # =================================================
  # COMMON MISTAKES
  # =================================================

  mount_mistakes:
    result:
      - description: >
          Common mount mistakes:
          - Using /dev/sdX in fstab
          - Forgetting nofail on external disks
          - Not testing with mount -a
          - Incorrect permissions
      - description: >
          Most boot failures from fstab are avoidable.

  # =================================================
  # RECOVERY
  # =================================================

  mount_recovery:
    result:
      - description: >
          If a bad fstab prevents boot:
          - Boot from live media
          - Mount root filesystem
          - Fix or comment faulty fstab entries
      - description: >
          Always keep a live USB available.

  mount_summary:
    result:
      - description: >
          Best practices:
          - Use UUIDs
          - Use nofail for non-critical disks
          - Test fstab changes
          - Prefer automount for slow or removable devices
