start: iwd_usage
nodes:
  iwd_usage:
    question: >
      iwd (iNet wireless daemon) is a modern Wi-Fi manager developed by Intel.
      How are you using iwd on your system?
    options:
      s: "Standalone (iwd manages Wi-Fi directly)"
      n: "Integrated with NetworkManager"
    next:
      s: standalone_intro
      n: nm_integration
  standalone_intro:
    question: >
      In standalone mode, iwd handles everything:
      scanning, authentication, and connection.
      Is the iwd service currently running?
    options:
      y: "Yes"
      n: "No"
    next:
      y: device_visible
      n: enable_iwd
  enable_iwd:
    result:
      - description: >
          iwd must be running to manage Wi-Fi.
        command: "sudo systemctl enable --now iwd"
  device_visible:
    question: >
      Let's check whether iwd can see your wireless hardware.
      When you run `iwctl device list`, does your device appear?
    options:
      y: "Yes, my device is listed"
      n: "No, nothing appears"
    next:
      y: scan_networks
      n: device_missing
  device_missing:
    result:
      - description: >
          If no wireless device appears, this is not yet a Wi-Fi configuration issue.
      - description: >
          Possible causes include blocked hardware, missing drivers, or missing firmware.
      - description: >
          Check rfkill, PCI/USB devices, and firmware messages.
  scan_networks:
    question: >
      Can iwd scan for networks successfully?
      (iwctl station <device> scan)
    options:
      y: "Yes, networks appear"
      n: "No, scan fails"
    next:
      y: connect
      n: scan_fail
  scan_fail:
    result:
      - description: >
          Scan failures often indicate driver, firmware, or regulatory issues.
      - description: >
          Verify driver loading, regulatory domain, and firmware availability.
  connect:
    question: >
      When you try to connect to a network, does it succeed?
    options:
      y: "Yes, connection succeeds"
      n: "No, connection fails"
    next:
      y: connected
      n: auth_fail
  connected:
    result:
      - description: >
          Wireless connection established successfully using iwd.
      - description: >
          iwd will automatically reconnect to known networks.
  auth_fail:
    question: >
      Does the failure mention authentication or a wrong passphrase?
    options:
      y: "Yes, authentication fails"
      n: "No, different error"
    next:
      y: auth_issue
      n: unknown_issue
  auth_issue:
    result:
      - description: >
          Authentication failures are commonly caused by incorrect credentials.
      - description: >
          Verify the Wi-Fi password, encryption type, and router compatibility.
      - description: >
          Try removing the network profile and reconnecting.
  unknown_issue:
    result:
      - description: >
          Non-authentication failures may indicate driver, firmware, or power issues.
        command: "journalctl -u iwd"
  nm_integration:
    question: >
      NetworkManager can use iwd as its Wi-Fi backend.
      Is NetworkManager already configured to use iwd?
    options:
      y: "Yes"
      n: "No or not sure"
    next:
      y: nm_ok
      n: nm_config
  nm_ok:
    result:
      - description: >
          NetworkManager is already using iwd.
      - description: >
          Manage Wi-Fi connections using nmcli or graphical tools.
      - description: >
          Avoid using iwctl directly in this configuration.
  nm_config:
    result:
      - description: >
          Configure NetworkManager to use iwd as its Wi-Fi backend.
      - description: >
          Edit /etc/NetworkManager/NetworkManager.conf and ensure the backend is set.
      - description: >
          Restart NetworkManager to apply changes.
        command: "sudo systemctl restart NetworkManager"
