start: iwd_usage

nodes:
  iwd_usage:
    question: >
      iwd (iNet wireless daemon) is a modern Wi-Fi manager developed by Intel.
      How are you using iwd on your system?
    options:
      s: "Standalone (iwd manages Wi-Fi directly)"
      n: "Integrated with NetworkManager"
    next:
      s: standalone_intro
      n: nm_integration

  # =================================================
  # STANDALONE IWD
  # =================================================

  standalone_intro:
    question: >
      In standalone mode, iwd handles everything:
      scanning, authentication, and connection.
      Is the iwd service currently running?
    options:
      y: "Yes"
      n: "No"
    next:
      y: device_visible
      n: enable_iwd

  enable_iwd:
    result:
      - description: >
          iwd must be running to manage Wi-Fi.
      - description: >
          Enable and start it with:
      - command: "sudo systemctl enable --now iwd"

  device_visible:
    question: >
      Let's check whether iwd can see your wireless hardware.
      When you run `iwctl device list`, does your device appear?
    options:
      y: "Yes, my device is listed"
      n: "No, nothing appears"
    next:
      y: scan_networks
      n: device_missing

  device_missing:
    result:
      - description: >
          If no wireless device appears, this is not yet a Wi-Fi configuration issue.
      - description: >
          Possible causes:
          - Wireless adapter is blocked (rfkill)
          - Kernel driver is missing
          - Firmware is not installed
      - description: >
          Check:
          - rfkill list
          - lspci / lsusb
          - dmesg | grep firmware

  scan_networks:
    question: >
      Can iwd scan for networks successfully?
      (iwctl station <device> scan)
    options:
      y: "Yes, networks appear"
      n: "No, scan fails"
    next:
      y: connect
      n: scan_fail

  scan_fail:
    result:
      - description: >
          Scan failures often indicate driver or regulatory issues.
      - description: >
          Check:
          - Correct kernel driver loaded
          - Country code (iw reg get)
          - Firmware availability

  connect:
    question: >
      When you try to connect to a network, does it succeed?
    options:
      y: "Yes, connection succeeds"
      n: "No, connection fails"
    next:
      y: connected
      n: auth_fail

  connected:
    result:
      - description: >
          Wireless connection established successfully using iwd.
      - description: >
          iwd will automatically reconnect to known networks.

  auth_fail:
    question: >
      Does the failure mention authentication or a wrong passphrase?
    options:
      y: "Yes, authentication fails"
      n: "No, different error"
    next:
      y: auth_issue
      n: unknown_issue

  auth_issue:
    result:
      - description: >
          Authentication failures are usually simple:
      - description: >
          - Incorrect Wi-Fi password
          - Wrong encryption type (WPA2 vs WPA3)
          - Router compatibility issues
      - description: >
          Try removing the network profile and reconnecting.

  unknown_issue:
    result:
      - description: >
          Failures without auth errors may point to:
      - description: >
          - Driver instability
          - Firmware bugs
          - Power management issues
      - description: >
          Inspect logs with:
      - command: "journalctl -u iwd"

  # =================================================
  # NETWORKMANAGER + IWD
  # =================================================

  nm_integration:
    question: >
      NetworkManager can use iwd as its Wi-Fi backend.
      Is NetworkManager already configured to use iwd?
    options:
      y: "Yes"
      n: "No / Not sure"
    next:
      y: nm_ok
      n: nm_config

  nm_ok:
    result:
      - description: >
          NetworkManager is already using iwd.
      - description: >
          Wi-Fi connections are managed via nmcli or GUI tools.
      - description: >
          Avoid using iwctl directly in this mode.

  nm_config:
    result:
      - description: >
          To configure NetworkManager to use iwd:
      - description: >
          Edit /etc/NetworkManager/NetworkManager.conf
      - description: >
          Add or ensure:
      - description: >
          [device]
          wifi.backend=iwd
      - description: >
          Then restart NetworkManager:
      - command: "sudo systemctl restart NetworkManager"

