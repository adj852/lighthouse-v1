start: gpu_detect
nodes:
  gpu_detect:
    question: >
      Let’s figure out your graphics setup.
      Which GPU is in your system?
    options:
      i: "Intel (integrated graphics)"
      a: "AMD"
      n: "NVIDIA"
      h: "Hybrid / dual-GPU (Intel+NVIDIA or AMD+NVIDIA)"
    next:
      i: intel_overview
      a: amd_overview
      n: nvidia_overview
      h: hybrid_overview
  intel_overview:
    result:
      - description: >
          Intel GPUs use the i915 kernel driver.
      - description: >
          The driver is included in the Linux kernel by default.
      - description: >
          For most users, Intel graphics work out of the box.
      - description: >
          Graphics acceleration is provided by Mesa.
    next: intel_packages
  intel_packages:
    result:
      - description: >
          Recommended packages:
          - mesa (OpenGL)
          - vulkan-intel (Vulkan)
      - description: >
          Optional but useful:
          - intel-media-driver (video decoding)
      - description: >
          Intel GPUs work very well with Wayland.
  intel_verify:
    result:
      - description: >
          Verify hardware acceleration:
          - glxinfo | grep "OpenGL renderer"
          - vulkaninfo
      - description: >
          If rendering shows "llvmpipe", acceleration is not working.
  amd_overview:
    result:
      - description: >
          Modern AMD GPUs use the amdgpu kernel driver.
      - description: >
          The driver is open-source and included in the kernel.
      - description: >
          Mesa provides OpenGL and Vulkan support.
      - description: >
          AMD graphics are very well supported on Linux.
    next: amd_packages
  amd_packages:
    question: >
      Which Vulkan driver do you want?
    options:
      r: "RADV (recommended open-source)"
      a: "AMDVLK (official AMD driver)"
    next:
      r: amd_radv
      a: amd_amdvlk
  amd_radv:
    result:
      - description: >
          RADV is the default and recommended Vulkan driver.
      - description: >
          Provided by Mesa.
      - description: >
          Install:
          - mesa
          - vulkan-radeon
  amd_amdvlk:
    result:
      - description: >
          AMDVLK is AMD’s official Vulkan driver.
      - description: >
          It may perform better in some workloads.
      - description: >
          Install:
          - amdvlk
  amd_verify:
    result:
      - description: >
          Verify acceleration:
          - glxinfo
          - vulkaninfo
      - description: >
          AMD works well on both X11 and Wayland.
  nvidia_overview:
    result:
      - description: >
          NVIDIA GPUs have two driver options:
          - Proprietary NVIDIA driver
          - Open-source nouveau driver
      - description: >
          The proprietary driver is strongly recommended.
      - description: >
          Nouveau lacks performance and power management.
    next: nvidia_choice
  nvidia_choice:
    question: >
      Which NVIDIA driver do you want?
    options:
      p: "Proprietary NVIDIA driver (recommended)"
      o: "Open-source nouveau (fallback only)"
    next:
      p: nvidia_kernel
      o: nouveau
  nouveau:
    result:
      - description: >
          Nouveau is community-developed.
      - description: >
          Limitations:
          - Poor performance
          - No proper power management
          - No modern Vulkan support
      - description: >
          Use only for troubleshooting or unsupported GPUs.
  nvidia_kernel:
    question: >
      Which kernel are you using?
    options:
      s: "linux (stable)"
      l: "linux-lts"
      c: "Custom kernel"
    next:
      s: nvidia_stable
      l: nvidia_lts
      c: nvidia_custom
  nvidia_stable:
    result:
      - description: >
          Install:
          - nvidia
          - linux-headers
      - description: >
          Enable early KMS for smoother boot and Wayland compatibility.
      - description: >
          Rebuild initramfs after installation.
  nvidia_lts:
    result:
      - description: >
          Install:
          - nvidia-lts
          - linux-lts-headers
      - description: >
          Rebuild initramfs after installation.
  nvidia_custom:
    result:
      - description: >
          Use DKMS-based driver:
          - nvidia-dkms
      - description: >
          Required for custom or non-standard kernels.
  nvidia_wayland:
    result:
      - description: >
          Wayland support requires:
          - NVIDIA driver 515+
          - modeset=1
      - description: >
          Some compositors may still have limitations.
  hybrid_overview:
    result:
      - description: >
          Hybrid systems have two GPUs:
          - Integrated GPU (Intel or AMD)
          - Discrete NVIDIA GPU
      - description: >
          Power management and switching must be configured manually.
    next: hybrid_methods
  hybrid_methods:
    question: >
      How do you want to use the NVIDIA GPU?
    options:
      p: "On-demand (recommended)"
      a: "Always on"
    next:
      p: prime_offload
      a: always_on
  prime_offload:
    result:
      - description: >
          PRIME offloading allows running apps on NVIDIA when needed.
      - description: >
          Default GPU remains Intel/AMD.
      - description: >
          Use:
          - prime-run <application>
      - description: >
          Best balance of battery life and performance.
  always_on:
    result:
      - description: >
          NVIDIA GPU is always active.
      - description: >
          Higher performance but increased power usage.
      - description: >
          Requires more complex configuration.
  hybrid_tools:
    result:
      - description: >
          Common tools:
          - optimus-manager (X11)
          - nvidia-prime
      - description: >
          Wayland support is improving but still limited in hybrid setups.
  gpu_troubleshooting:
    result:
      - description: >
          Common GPU issues:
          - Black screen after install
          - Falling back to llvmpipe
          - Wayland session fails to start
      - description: >
          Always check:
          - Kernel modules loaded
          - Correct packages installed
          - initramfs rebuilt
